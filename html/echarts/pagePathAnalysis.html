<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>页面跳出率分析</title><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/bootstrap-3.3.5/css/bootstrap.css?v=bba40d0d97"><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/jquery-jbox/2.3/Skins/Blue/jbox.css"><link rel="stylesheet" type="text/css" href="/gulpdemo/css/common.css?v=834de0cd75"><style type="text/css">svg rect,svg text,svg tspan{cursor:pointer}#chartDiv{padding-top:10px;padding-left:10px;padding-right:10px}.page{margin-bottom:30px;display:flex;display:-ms-flex;display:-webkit-flex}.page span{display:inline-block;font-size:13px;line-height:30px;text-align:center;border:1px solid #d8d6d6;background-color:#f6f6f6;flex:1;-ms-flex:1;-webkit-flex:1;-webkit-box-flex:1;position:relative}.pathvalue{position:absolute;padding:5px 10px;background-color:#fff;background-color:rgba(255,255,255,.8);border-radius:4px;border:1px solid #ddd;box-shadow:1px 1px 3px rgba(0,0,0,.2);transition:display 5s ease-in-out 0s;color:#000}.no-data{text-align:center;color:red;font-size:16px}</style></head><body><header class="header"><nav><ul class="navigation"><li><a href="/gulpdemo/index.html" target="_self" title="返回首页" class="home"></a></li><li><a href="/gulpdemo/html/mobile/taobao_adapter.html">移动端</a></li><li><a href="/gulpdemo/html/webDesign/vertical_align.html" target="_self">网页布局</a></li><li><a href="/gulpdemo/html/javascript/chinamap.html" target="_self">javascript & JQuery</a></li><li><a href="/gulpdemo/html/css3/transform.html" target="_self">CSS3</a></li><li><a href="/gulpdemo/html/h5/img2base64.html" target="_self">H5</a></li><li><a href="/gulpdemo/html/plugin/plugin_instruction.html" target="_self">插件说明</a></li><li><a href="/gulpdemo/html/echarts/freshness.html" target="_self">echarts</a></li></ul></nav></header><div class="container01"><div class="c-left"><input type="hidden" value="7" id="menuId"><div class="side-menu"><ul class="side-menu-list"><li><a href="/gulpdemo/html/echarts/freshness.html"><i class="icon-blank"></i>用户新鲜度</a></li><li><a href="/gulpdemo/html/echarts/funnel.html"><i class="icon-blank"></i>漏斗模型</a></li><li><a href="/gulpdemo/html/echarts/userTransition.html"><i class="icon-blank"></i>用户构成</a></li><li><a href="/gulpdemo/html/echarts/pagePathAnalysis.html"><i class="icon-blank"></i>页面跳出率分析</a></li></ul></div></div><div class="c-right">起始页面：<select name="startPage" id="startPage"><option value="0" selected="selected">服务</option><option value="1">旅游</option><option value="2">活动</option><option value="3">活动详情</option></select><div id="chartDiv" style="height:auto;position:relative;min-height:300px;min-width:1000px"><div class="page"><span>第一页</span><span>第二页</span><span>第三页</span><span>第四页</span><span>第五页</span></div></div></div></div><footer class="footer"><p>Author: wangyaru</p><p>Created time: 2016/02/15</p><p>&copy;forever</p></footer><script type="text/javascript" src="/gulpdemo/js/jquery-1.12.1.js?v=da6deec5d1"></script><script type="text/javascript" src="/gulpdemo/js/jquery-migrate-1.1.1.js?v=d62a5c2a27"></script><script type="text/javascript" src="/gulpdemo/plugin/bootstrap-3.3.5/js/bootstrap.js?v=5a9f44d675"></script><script type="text/javascript" src="/gulpdemo/plugin/jquery-jbox/2.3/jquery.jBox-2.3.src.js?v=568416d5b1"></script><script type="text/javascript" src="/gulpdemo/js/main.js?v=6f399efa9e"></script><script type="text/javascript" src="/gulpdemo/js/echarts/d3.js?v=1e196382c2"></script><script type="text/javascript">function getChartData(){var t={nodes:[],links:[]},n=0,e=json[$("#startPage").val()];$.ajax({type:"get",url:"/gulpdemo/js/data/"+e+".node.js",data:{},dataType:"json",success:function(e){t.nodes=e.data;var o=1,r=0;inputNum=0;for(var a=0,i=e.data.length;a<i;a++){var u=e.data[a].page_visit_num;o==u?r++:(o=u,r=1),0==a&&(inputNum=e.data[a].value)}pageColums=o,n++,2==n&&renderSankey(t)}}),$.ajax({type:"get",url:"/gulpdemo/js/data/"+e+".path.js",data:{},dataType:"json",success:function(e){t.links=e.data,n++,2==n&&renderSankey(t)}})}function renderSankey(t){var n=document.getElementById("chartDiv"),e=$("#noData");0==t.nodes.length?0==e.length&&$(n).append('<div class="no-data" id="noData">暂无数据！</div>'):e.remove();for(var o=n.offsetWidth,r=.05*o,a=(o-r)*pageColums/5,i=[],u=0,s=t.nodes.length;u<s;u++)-1==$.inArray(t.nodes[u].title,i)&&i.push(t.nodes[u].title);var c=d3.sankey().nodeWidth(140).nodePadding(12).size([a,Math.max(750,inputNum/1.5)]).nodes(t.nodes).links(t.links).layout(0),d=c.link();d3.select("svg").remove();var f=d3.select("#chartDiv").append("svg").attr("width",a).attr("height",Math.max(750,inputNum/1.5)).attr("style","padding:10px 0"),l=f.append("g").selectAll("path").data(t.links).enter(),p=f.append("g").selectAll(".node").data(t.nodes).enter(),y=l.append("path").attr({fill:"none",stroke:"#d0cece","stroke-opacity":.5,d:d,id:function(t,n){return"link"+n},"class":function(t,n){return"s"+t.source.i+" t"+t.target.i}}).style("stroke-width",function(t){return 0==t.path_num?0:t.dy}).style("display",function(t){return 0==t.path_num?"none":"block"});y.on("mouseover",function(t,n){var e=$(".s"+t.source.i+".t"+t.target.i);0!=t.path_num&&.1!=e.attr("stroke-opacity")&&(tooltip.html("从“"+t.source_title+"”<br/>到“"+t.target_title+"”<br />会话数："+t.path_num).style({left:d3.event.pageX+10+"px",top:d3.event.pageY-60+"px",display:"block"}),e.attr({"stroke-opacity":.8}))}).on("mousemove",function(t){var n=$(".s"+t.source.i+".t"+t.target.i);.1!=n.attr("stroke-opacity")&&tooltip.style({left:d3.event.pageX+10+"px",top:d3.event.pageY-60+"px"})}).on("mouseout",function(t){var n=$(".s"+t.source.i+".t"+t.target.i);.1!=n.attr("stroke-opacity")&&(tooltip.style("display","none"),n.attr({"stroke-opacity":.5}))});var h=d3.rgb("#2f9ca1"),g=d3.rgb("#dde76e"),v=d3.interpolate(h,g),k=p.append("rect").attr({x:function(t){return t.x?t.x:0},y:function(t){return t.y?t.y:0},height:function(t){return t.dy?t.dy:0},width:c.nodeWidth(),fill:function(t,n){return v($.inArray(t.title,i)/Math.max(1,i.length-1))}}),m=p.append("text").attr({x:function(t){return t.x?t.x+5:5},y:function(t){return tspanY(t,0)}}).attr("font-size",12);m.append("tspan").attr({x:function(t){return t.x?t.x+5:5},y:function(t){return tspanY(t,-15)},fill:d3.rgb(73,59,3),style:"font-size:14px;font-weight:bold"}).text(function(t){return t.title}),m.append("tspan").attr({x:function(t){return t.x?t.x+5:5},y:function(t){return tspanY(t,0)},style:function(t){return(t.dy?t.dy:0)<nodeMinHeight?"display:none;":""}}).text(function(t){return"session会话数："+t.visit_num}),m.append("tspan").attr({x:function(t){return t.x?t.x+5:5},y:function(t){return tspanY(t,15)},style:function(t){return(t.dy?t.dy:0)<nodeMinHeight?"display:none;":""}}).text(function(t){return"跳出率："+t.leave_rate}),k.on("mouseover",function(t,n){nodeMouseOver(t,n)}).on("mousemove",function(t){nodeMouseMove(t)}).on("mouseout",function(t){nodeMouseOut(t)}).on("click",function(t){nodeClick(t)}),m.on("mouseover",function(t,n){nodeMouseOver(t,n)}).on("mousemove",function(t){nodeMouseMove(t)}).on("mouseout",function(t){nodeMouseOut(t)}).on("click",function(t){nodeClick(t)})}function tspanY(t,n){var e=t.dy?t.dy:0,o=t.y?t.y:0,r=0;return r=e<nodeMinHeight?o+(e+10)/2:e>=600?300+n:o+(e+10)/2+n}function nodeMouseOver(t,n){t.dy<nodeMinHeight&&tooltip.html("<span style='color:#493b03;font-weight: bold;'>"+t.title+"</span><br/>session会话数："+t.visit_num+"<br />跳出率："+t.leave_rate).style({left:d3.event.pageX+10+"px",top:d3.event.pageY-60+"px",display:"block"})}function nodeMouseMove(t){t.dy<nodeMinHeight&&tooltip.style({left:d3.event.pageX+10+"px",top:d3.event.pageY-60+"px"})}function nodeMouseOut(t){t.dy<nodeMinHeight&&tooltip.style("display","none")}function nodeClick(t){this.lastClickNode!=t.i&&(this.lastClickNode=t.i,event.stopPropagation(),$("path").attr({stroke:"#d0cece","stroke-opacity":.1}),setPathHighlight(t))}function setPathHighlight(t){var n=arguments.callee;$("path.s"+t.i).attr({stroke:"#5a5cb1","stroke-opacity":.5});for(var e=0,o=t.sourceLinks.length;e<o;e++)0!=t.sourceLinks[e].path_num&&n(t.sourceLinks[e].target)}var json=["service","travel","activity","detail"];$(function(){getChartData(),$("body").click(function(){window.lastClickNode=-1,$("path").attr({stroke:"#d0cece","stroke-opacity":.4})})});var tooltip=d3.select("body").append("div").attr("class","pathvalue").style("display","none"),nodeMinHeight=45,inputNum=0,pageColums=5;$("#startPage").change(function(){getChartData()}),d3.sankey=function(){function t(){p.forEach(function(t){t.sourceLinks=[],t.targetLinks=[]}),y.forEach(function(t){var n=t.source,e=t.target;"number"==typeof n&&(n=t.source=p[t.source]),"number"==typeof e&&(e=t.target=p[t.target]),n.sourceLinks.push(t),e.targetLinks.push(t)})}function n(){p.forEach(function(t){t.value||(t.value=Math.max(d3.sum(t.sourceLinks,s),d3.sum(t.targetLinks,s)))})}function e(){for(var t,n=p,e=0;n.length;)t=[],n.forEach(function(n){n.x=e,n.dx=d,n.sourceLinks.forEach(function(n){t.indexOf(n.target)<0&&t.push(n.target)})}),n=t,++e;o(e),r((l[0]-d)/(e-1))}function o(t){p.forEach(function(n){n.sourceLinks.length||(n.x=t-1)})}function r(t){p.forEach(function(n){n.x*=t})}function a(t){function n(){var t=d3.min(i,function(t){return(l[1]-(t.length-1)*f)/d3.sum(t,s)});i.forEach(function(n){n.forEach(function(n,e){n.y=e,n.dy=n.value*t})}),y.forEach(function(n){n.dy=n.value*t})}function e(t){function n(t){return u(t.source)*t.value}i.forEach(function(e,o){e.forEach(function(e){if(e.targetLinks.length){var o=d3.sum(e.targetLinks,n)/d3.sum(e.targetLinks,s);e.y+=(o-u(e))*t}})})}function o(t){function n(t){return u(t.target)*t.value}i.slice().reverse().forEach(function(e){e.forEach(function(e){if(e.sourceLinks.length){var o=d3.sum(e.sourceLinks,n)/d3.sum(e.sourceLinks,s);e.y+=(o-u(e))*t}})})}function r(){i.forEach(function(t){var n,e,o,r=0,i=t.length;for(t.sort(a),o=0;o<i;++o)n=t[o],e=r-n.y,e>0&&(n.y+=e),r=n.y+n.dy+f;if(e=r-f-l[1],e>0)for(r=n.y-=e,o=i-2;o>=0;--o)n=t[o],e=n.y+n.dy+f-r,e>0&&(n.y-=e),r=n.y})}function a(t,n){return t.y-n.y}var i=d3.nest().key(function(t){return t.x}).sortKeys(d3.ascending).entries(p).map(function(t){return t.values});n(),r();for(var c=1;t>0;--t)o(c*=.99),r(),e(c),r()}function i(){function t(t,n){return t.source.y-n.source.y}function n(t,n){return t.target.y-n.target.y}p.forEach(function(e){e.sourceLinks.sort(n),e.targetLinks.sort(t)}),p.forEach(function(t){var n=0,e=0;t.sourceLinks.forEach(function(t){t.sy=n,n+=t.dy}),t.targetLinks.forEach(function(t){t.ty=e,e+=t.dy})})}function u(t){return t.y+t.dy/2}function s(t){return t.value}var c={},d=24,f=8,l=[1,1],p=[],y=[];return c.nodeWidth=function(t){return arguments.length?(d=+t,c):d},c.nodePadding=function(t){return arguments.length?(f=+t,c):f},c.nodes=function(t){return arguments.length?(p=t,c):p},c.links=function(t){return arguments.length?(y=t,c):y},c.size=function(t){return arguments.length?(l=t,c):l},c.layout=function(o){return t(),n(),e(),a(o),i(),c},c.relayout=function(){return i(),c},c.link=function(){function t(t){var e=t.source.x+t.source.dx,o=t.target.x,r=d3.interpolateNumber(e,o),a=r(n),i=r(1-n),u=t.source.y+t.sy+t.dy/2,s=t.target.y+t.ty+t.dy/2;return"M"+e+","+u+"C"+a+","+u+" "+i+","+s+" "+o+","+s}var n=.5;return t.curvature=function(e){return arguments.length?(n=+e,t):n},t},c}</script></body></html>