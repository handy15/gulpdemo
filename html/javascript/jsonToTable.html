<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>根据json结构创建table</title><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/bootstrap-3.3.5/css/bootstrap.css?v=bba40d0d97"><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/jquery-jbox/2.3/Skins/Blue/jbox.css"><link rel="stylesheet" type="text/css" href="/gulpdemo/css/common.css?v=834de0cd75"><style type="text/css">*{padding:0;margin:0}body{font-size:16px;font-family:'microsoft Yahei',"Helvetica Neue",Helvetica,Arial,sans-serif;line-height:1.2}::-webkit-input-placeholder{color:#777}:-moz-placeholder{color:#777}::-moz-placeholder{color:#777}:-ms-input-placeholder{color:#777}.showDiv{width:99%;margin:15px auto;overflow:hidden;overflow-x:auto}.showDiv h2{padding-bottom:20px;text-align:center}.search{padding:10px 0 10px 15px;background:#f2f2f2;border-radius:6px}input{line-height:1.2;font-family:'microsoft Yahei';font-size:16px}.ipt-text{width:300px;border:1px solid #ccc;border-radius:4px;padding:6px 12px;box-shadow:0 1px 1px rgba(0,0,0,.075) inset;transition:border-color .15s ease-in-out 0s,box-shadow .15s ease-in-out 0s;color:#555;vertical-align:middle}.ipt-text:focus{border-color:#66afe9;box-shadow:0 1px 1px rgba(0,0,0,.075) inset,0 0 8px rgba(102,175,233,.6);outline:0 none}.btn{background-color:#428bca;border:1px solid #357ebd;border-radius:4px;padding:6px 12px;color:#fff;cursor:pointer;vertical-align:middle}.btn:hover{background-color:#3071a9;border-color:#285e8e}.tips{padding-left:8px;color:red;font-size:14px}.myTable{width:100%;border-collapse:collapse;border:1px solid #e1e1e1;font-size:14px}.myTable td,.myTable th{border:1px solid #e1e1e1;padding:10px 5px;text-align:center}.myTable thead th{background:#f2f2f2;background-image:-webkit-gradient(linear,left 0,left 100%,from(#f8f8f8),to(#ececec));background-image:-webkit-linear-gradient(top,#f8f8f8,0,#ececec,100%);background-image:-moz-linear-gradient(top,#f8f8f8 0,#ececec 100%);background-image:linear-gradient(to bottom,#f8f8f8 0,#ececec 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fff8f8f8', endColorstr='#ffececec', GradientType=0);padding:10px;color:#777}.myTable tbody th{background-color:#f6fcff;font-weight:400}.myTable td{text-align:left;transition:background-color .15s ease-in-out 0s,color .15s ease-in-out 0s}.myTable tr:hover td{background-color:#eff4f7}.myTable tr.active td{background-color:#ffab00;color:#fff}</style></head><body><header class="header"><nav><ul class="navigation"><li><a href="/gulpdemo/index.html" target="_self" title="返回首页" class="home"></a></li><li><a href="/gulpdemo/html/mobile/taobao_adapter.html">移动端</a></li><li><a href="/gulpdemo/html/webDesign/vertical_align.html" target="_self">网页布局</a></li><li><a href="/gulpdemo/html/javascript/chinamap.html" target="_self">javascript & JQuery</a></li><li><a href="/gulpdemo/html/css3/transform.html" target="_self">CSS3</a></li><li><a href="/gulpdemo/html/h5/img2base64.html" target="_self">H5</a></li><li><a href="/gulpdemo/html/plugin/plugin_instruction.html" target="_self">插件说明</a></li><li><a href="/gulpdemo/html/echarts/freshness.html" target="_self">echarts</a></li></ul></nav></header><div class="container01"><div class="c-left"><input type="hidden" value="3" id="menuId"><div class="side-menu"><ul class="side-menu-list"><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>基础知识</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/base/array.html">Array</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/chinamap.html">中国地图</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>高德地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/gaode/gdMap.html">示例</a></li><li><a href="/gulpdemo/html/javascript/gaode/map.html">搜索结果列表</a></li><li><a href="/gulpdemo/html/javascript/gaode/poi.html">iframe传参</a></li><li><a href="/gulpdemo/html/javascript/gaode/adjustPosition.html">调整坐标</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>百度地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/baidu/baidu-map.html">百度地图</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>form元素</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/formBeauty/select.html">select美化</a></li><li><a href="/gulpdemo/html/javascript/formBeauty/radio.html">radio & checkbox美化</a></li><li><a href="/gulpdemo/html/javascript/formBeauty/ajax_upload.html">ajax上传文件</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>JOSN结构转Table</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/jsonToTable.html">示例1</a></li><li><a href="/gulpdemo/html/javascript/jsonToTable1.html">示例2</a></li></ul></li><li><a href="/gulpdemo/html/javascript/date_compare.html"><i class="icon-blank"></i>时间跨时区比较</a></li><li><a href="/gulpdemo/html/javascript/heavenly.html"><i class="icon-blank"></i>天干地支纪年</a></li><li><a href="/gulpdemo/html/javascript/table_sort.html"><i class="icon-blank"></i>table sort</a></li></ul></div></div><div class="c-right"><div class="showDiv"><h2>埋点实时展示</h2><div class="search"><label for="msg">查询条件：</label><input class="ipt-text" type="text" id="msg" placeholder="可以是设备号也可以是用户ID"> <input class="btn" type="button" onclick="settingDN()" value="设置查询条件"> <span class="tips" id="tips"></span></div><div style="overflow:auto;margin-top:15px"><table id="table" class="myTable"><thead></thead><tbody></tbody></table></div></div><h1>HTML代码</h1><pre class="brush:xml">
            <table id="table" class="myTable">
                <thead></thead>
                <tbody></tbody>
            </table>
        </pre><h1>JS代码</h1><pre class="brush:js">
            document.getElementById("table").parentNode.style.maxHeight = window.innerHeight - 150;
    var ws;
    function connection(){
        ws = new WebSocket("ws://localhost:8080/dataInterOper/buriedPoint");
        ws.onopen = function(evn){
            console.log(evn);
        };
        ws.onmessage = function(evn){
            console.log(evn.data);
            var table = document.getElementById("table");
            var tips = document.getElementById("tips");
            var thisData = evn.data;
            var table_rows = 1;
            var timmer = setInterval(function(){
                thisData = '{"ui":"335795","dv":"' + Math.ceil(Math.random()*100) +'","tt":"100","fi":"","receiveTime":"2016-12-14 11:42:16.0703","ci":"","sf":"6382C3D3-DCBA-44F6-BF92-AA47513034D3","ft":"4","dn":"DBCF66C3-5EAF-43AE-9007-29BFEB1128D9","oi":"2c9c9c6f58fb51980158fb6c6c7f04aa","bc":"19","bd":"\"{\"details\":\"自动登陆拉取feed完成\",\"startStatus\":\"1\",\"startId\":\"2016\\/12\\/14 11:42:15 03\",\"moduleId\":\"19\",\"type\":\"0\",\"telephone\":\"\",\"conTime\":\"2016\\/12\\/14 11:42:16 715\"}\"","ip":"106.39.33.246"}';
                if(table_rows&lt;6){
                    try{
                        var obj=JSON.parse(thisData.replace('""{','{').replace('}""','}'));
                        var keys = getKeys(obj);
                        //获取obj的层深，决定行数
                        var thead = table.getElementsByTagName('thead')[0];
                        var tbody = table.getElementsByTagName('tbody')[0];
                        //初始化table的表头
                        if(!thead.hasChildNodes()){
                            //计算表头的行数
                            var theadRowNum = 0;
                            var reg = /\[[^\[\]]*\]/g;
                            for(var i= 0,len=keys.length;i&lt;len;i++){
                                theadRowNum = Math.max(theadRowNum,keys[i].match(reg).length);
                            }
                            var fragmentTrs = document.createDocumentFragment('');
                            for(var j= 1;j&lt;=theadRowNum;j++){
                                //储存colspan不为1的title
                                var colspanTxt = [];
                                var fragment = document.createDocumentFragment('');
                                for(var i= 0,len=keys.length;i&lt;len;i++){
                                    var texts = keys[i].match(reg);
                                    if(j &lt;= texts.length){
                                        var th = document.createElement('th');
                                        th.innerHTML = texts[j-1].replace('["','').replace('"]','');
                                        if(j == texts.length){
                                            th.rowSpan = (theadRowNum-j+1);
                                            fragment.appendChild(th);
                                        }else{
                                            var thisTxt = texts[j-1];
//                                            console.log(colspanTxt.indexOf(thisTxt));
                                            if(-1 == colspanTxt.indexOf(thisTxt)){
                                                colspanTxt.push(thisTxt);
                                                //计算colspan的值
                                                var thisColspanNum = 0;
                                                var reg01 = new RegExp(thisTxt.replace('[','\\[').replace(']','\\]'),'g');
                                                for(var k = i;k&lt;len;k++){
                                                    if(keys[k].match(reg01)){
                                                        thisColspanNum++;
                                                    }
                                                }
                                                th.colSpan=thisColspanNum;
                                                fragment.appendChild(th);
                                            }
                                        }
                                    }
                                }
                                var tr = document.createElement('tr');
                                tr.appendChild(fragment);
                                fragmentTrs.appendChild(tr);
                            }
                            thead.appendChild(fragmentTrs);
                        }
                        //追加body的数据
                        var fragmentBody = document.createDocumentFragment('');
                        for(var i= 0,len=keys.length;i&lt;len;i++){
                            var td = document.createElement('td');
                            td.innerHTML = eval('obj' + keys[i]);
                            fragmentBody.appendChild(td);
                        }
                        var tr = document.createElement('tr');
                        tr.className = 'active';
                        tr.appendChild(fragmentBody);
                        tbody.insertBefore(tr,tbody.firstChild);
                        //定时清楚高亮
                        setTimeout(function(){
                            tr.className = tr.className.replace('active','');
                        },1000);
                    }catch(e){
                        //error in the above string parse to JSON(in this case,yes)!
                        console.log(e);
                        tips.innerHTML=thisData;
                    }
                }else{
                    clearInterval(timmer);
                }
                table_rows++;
            },1500);
        };
        ws.onclose = function(){
            console.log("关闭");
        };

    };
    function settingDN(){
        var msg = document.getElementById("msg").value;
        ws.send(msg);
        document.getElementById("msg").value = "";
    }
    //遍历key值确保按顺序输出
    function getKeys(obj,objectName){
        var self = arguments.callee;
        var keys = [];
        for(var p in obj){
            if(typeof obj[p] == 'object'){
                var parent = objectName ? objectName + '["' + p + '"]' : '["' + p + '"]';
                keys = keys.concat(self(obj[p],parent));
            }else{
                keys.push(objectName ? objectName + '["' + p + '"]' : '["' + p + '"]');
            }
        }
        return keys;
    }
    //console.log(getKeys({"a":{"b":{"c":5},"c":9},"d":"abcdef"}));
    //判断array中是否存在某个字符串
    Array.prototype.indexOf = function(val){
        for(var i= 0,len=this.length;i&lt;len;i++){
            if(val === this[i]){
                return i;
            }
        }
        return -1;
    }
    connection();
        </pre></div></div><footer class="footer"><p>Author: wangyaru</p><p>Created time: 2016/02/15</p><p>&copy;forever</p></footer><script type="text/javascript" src="/gulpdemo/js/jquery-1.12.1.js?v=da6deec5d1"></script><script type="text/javascript" src="/gulpdemo/js/jquery-migrate-1.1.1.js?v=d62a5c2a27"></script><script type="text/javascript" src="/gulpdemo/plugin/bootstrap-3.3.5/js/bootstrap.js?v=5a9f44d675"></script><script type="text/javascript" src="/gulpdemo/plugin/jquery-jbox/2.3/jquery.jBox-2.3.src.js?v=568416d5b1"></script><script type="text/javascript" src="/gulpdemo/js/main.js?v=6f399efa9e"></script><script type="text/javascript">function connection(){ws=new WebSocket("ws://localhost:8080/dataInterOper/buriedPoint"),ws.onopen=function(e){console.log(e)},ws.onmessage=function(evn){console.log(evn.data);var table=document.getElementById("table"),tips=document.getElementById("tips"),thisData=evn.data,table_rows=1,timmer=setInterval(function(){if(thisData='{"ui":"335795","dv":"'+Math.ceil(100*Math.random())+'","tt":"100","fi":"","receiveTime":"2016-12-14 11:42:16.0703","ci":"","sf":"6382C3D3-DCBA-44F6-BF92-AA47513034D3","ft":"4","dn":"DBCF66C3-5EAF-43AE-9007-29BFEB1128D9","oi":"2c9c9c6f58fb51980158fb6c6c7f04aa","bc":"19","bd":""{"details":"自动登陆拉取feed完成","startStatus":"1","startId":"2016\\/12\\/14 11:42:15 03","moduleId":"19","type":"0","telephone":"","conTime":"2016\\/12\\/14 11:42:16 715"}"","ip":"106.39.33.246"}',table_rows<6)try{var obj=JSON.parse(thisData.replace('""{',"{").replace('}""',"}")),keys=getKeys(obj),thead=table.getElementsByTagName("thead")[0],tbody=table.getElementsByTagName("tbody")[0];if(!thead.hasChildNodes()){for(var theadRowNum=0,reg=/\[[^\[\]]*\]/g,i=0,len=keys.length;i<len;i++)theadRowNum=Math.max(theadRowNum,keys[i].match(reg).length);for(var fragmentTrs=document.createDocumentFragment(""),j=1;j<=theadRowNum;j++){for(var colspanTxt=[],fragment=document.createDocumentFragment(""),i=0,len=keys.length;i<len;i++){var texts=keys[i].match(reg);if(j<=texts.length){var th=document.createElement("th");if(th.innerHTML=texts[j-1].replace('["',"").replace('"]',""),j==texts.length)th.rowSpan=theadRowNum-j+1,fragment.appendChild(th);else{var thisTxt=texts[j-1];if(-1==colspanTxt.indexOf(thisTxt)){colspanTxt.push(thisTxt);for(var thisColspanNum=0,reg01=new RegExp(thisTxt.replace("[","\\[").replace("]","\\]"),"g"),k=i;k<len;k++)keys[k].match(reg01)&&thisColspanNum++;th.colSpan=thisColspanNum,fragment.appendChild(th)}}}}var tr=document.createElement("tr");tr.appendChild(fragment),fragmentTrs.appendChild(tr)}thead.appendChild(fragmentTrs)}for(var fragmentBody=document.createDocumentFragment(""),i=0,len=keys.length;i<len;i++){var td=document.createElement("td");td.innerHTML=eval("obj"+keys[i]),fragmentBody.appendChild(td)}var tr=document.createElement("tr");tr.className="active",tr.appendChild(fragmentBody),tbody.insertBefore(tr,tbody.firstChild),setTimeout(function(){tr.className=tr.className.replace("active","")},1e3)}catch(e){console.log(e),tips.innerHTML=thisData}else clearInterval(timmer);table_rows++},1500)},ws.onclose=function(){console.log("关闭")}}function settingDN(){var e=document.getElementById("msg").value;ws.send(e),document.getElementById("msg").value=""}function getKeys(e,t){var a=arguments.callee,n=[];for(var r in e)if("object"==typeof e[r]){var o=t?t+'["'+r+'"]':'["'+r+'"]';n=n.concat(a(e[r],o))}else n.push(t?t+'["'+r+'"]':'["'+r+'"]');return n}document.getElementById("table").parentNode.style.maxHeight=window.innerHeight-150;var ws;Array.prototype.indexOf=function(e){for(var t=0,a=this.length;t<a;t++)if(e===this[t])return t;return-1},connection()</script><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shCoreDefault.css?v=b1f1863310"><script type="text/javascript" src="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shCore.js?v=990e7f9af1"></script><script type="text/javascript" src="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shAutoloader.js?v=7b30a548e7"></script><script type="text/javascript">$(document).ready(function(){SyntaxHighlighter.autoloader(["js","jscript","javascript","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushJScript.js?v=614d07995f"],["css","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushCss.js?v=25fa849321"],["xml","html","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushXml.js?v=035d0131d7"]),SyntaxHighlighter.all()})</script></body></html>