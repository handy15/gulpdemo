<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>时间跨时区比较</title><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/bootstrap-3.3.5/css/bootstrap.css?v=bba40d0d97"><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/jquery-jbox/2.3/Skins/Blue/jbox.css"><link rel="stylesheet" type="text/css" href="/gulpdemo/css/common.css?v=c828de3005"></head><body><header class="header"><nav><ul class="navigation"><li><a href="/gulpdemo/index.html" target="_self" title="返回首页" class="home"></a></li><li><a href="/gulpdemo/html/mobile/taobao_adapter.html">移动端</a></li><li><a href="/gulpdemo/html/webDesign/vertical_align.html" target="_self">网页布局</a></li><li><a href="/gulpdemo/html/javascript/chinamap.html" target="_self">javascript & JQuery</a></li><li><a href="/gulpdemo/html/css3/transform.html" target="_self">CSS3</a></li><li><a href="/gulpdemo/html/h5/img2base64.html" target="_self">H5</a></li><li><a href="/gulpdemo/html/plugin/plugin_instruction.html" target="_self">插件说明</a></li><li><a href="/gulpdemo/html/echarts/freshness.html" target="_self">echarts</a></li></ul></nav></header><div class="container01"><div class="c-left"><input type="hidden" value="3" id="menuId"><div class="side-menu"><ul class="side-menu-list"><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>基础知识</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/base/array.html">Array</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/chinamap.html">中国地图</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>高德地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/gaode/gdMap.html">示例</a></li><li><a href="/gulpdemo/html/javascript/gaode/map.html">搜索结果列表</a></li><li><a href="/gulpdemo/html/javascript/gaode/poi.html">iframe传参</a></li><li><a href="/gulpdemo/html/javascript/gaode/adjustPosition.html">调整坐标</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>百度地图</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/baidu/baidu-map.html">百度地图</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>form元素</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/formBeauty/select.html">select美化</a></li><li><a href="/gulpdemo/html/javascript/formBeauty/radio.html">radio & checkbox美化</a></li><li><a href="/gulpdemo/html/javascript/formBeauty/ajax_upload.html">ajax上传文件</a></li></ul></li><li><a href="#"><i class="glyphicon glyphicon-menu-right"></i>JOSN结构转Table</a><ul class="side-menu-child hide"><li><a href="/gulpdemo/html/javascript/jsonToTable.html">示例1</a></li><li><a href="/gulpdemo/html/javascript/jsonToTable1.html">示例2</a></li></ul></li><li><a href="/gulpdemo/html/javascript/date_compare.html"><i class="icon-blank"></i>时间跨时区比较</a></li><li><a href="/gulpdemo/html/javascript/heavenly.html"><i class="icon-blank"></i>天干地支纪年</a></li><li><a href="/gulpdemo/html/javascript/table_sort.html"><i class="icon-blank"></i>table sort</a></li></ul></div></div><div class="c-right"><h1>时间跨时区比较</h1><p>此脚本是针对CT时间（美国中部时区——CENTRAL TIME(CT) 芝加哥、圣路易斯、新奥尔良、休斯顿等在此时区）与客户端本机所在时区时间的比较。经统一转换为格林威治时间，通过时间戳来比较。</p><p>此脚本是文本框中输入的时间与当前时间的比较。输入的时间格式为：<strong>December 17, 2015 | 0:48 AM CT</strong></p><div class="form-inline"><div class="form-group"><label for="input">请输入CT时间：</label><input type="text" class="form-control" id="input" placeholder="December 17, 2016 | 0:48 AM CT" value="" style="width:300px"></div><button type="submit" class="btn btn-default" id="compare">比较</button></div><div class="alert alert-danger mt20px" role="alert">结果：<span id="result"></span></div><h1>JS代码</h1><pre class="brush:js">
            var compareDate = {
                // 早于当前时间返回false，晚于当前时间返回true
                compareWithNow: function(str){
                    var that = this;
                    var arrayStr = str.split('|');
                    var strTime = arrayStr[1].match(/\d{1,2}:\d{2} (AM|PM)/g);//获取时间字符串
                    var dateCompared;
                    if(strTime){
                        dateCompared = new Date(arrayStr[0] + that.clock12To24(strTime[0]));
                    }else{
                        dateCompared = new Date(arrayStr[0]);
                    }
                    if(dateCompared == 'Invalid Date'){
                        return null;
                    }else{
                        // CT时间转换成国际标准时间
                        var offsetCT = 6; // CT与国际标准时间的时差，单位为小时
                        var utc_dateCompared = dateCompared.valueOf() + offsetCT * 3600000;
                        // console.log(dateCompared.valueOf() + ',' + utc_dateCompared);

                        // 当地时间转换成国际标准时间
                        var now = new Date();
                        var utc_now = now.valueOf() + now.getTimezoneOffset() * 60000;
                        // console.log(now.valueOf() + ',' + utc_now);
                        // console.log(now.getTimezoneOffset());
                        return utc_now - utc_dateCompared;
                    }
                },
                // str格式为11:00 AM 或 2:35 PM
                clock12To24: function (str){
                    var returnValue = '00:00';
                    if(str.match(/^\d{1,2}:\d{2} (AM|PM)$/g)){
                        var array = str.split(' ');
                        if(array[1] == 'AM'){
                            returnValue = array[0];
                        }else{
                            var time = array[0].match(/^\d{1,2}/g);
                            if(time){
                                returnValue = array[0].replace(/^\d{1,2}/,12 + parseInt(time[0]));
                            }
                        }
                    }
                    return returnValue;
                }
            }
            //调用方法
            compareDate.compareWithNow('December 17, 2015 | 0:48 AM CT')
        </pre></div></div><footer class="footer"><p>Author: wangyaru</p><p>Created time: 2016/02/15</p><p>&copy;forever</p></footer><script type="text/javascript" src="/gulpdemo/js/jquery-1.12.1.js?v=da6deec5d1"></script><script type="text/javascript" src="/gulpdemo/js/jquery-migrate-1.1.1.js?v=d62a5c2a27"></script><script type="text/javascript" src="/gulpdemo/plugin/bootstrap-3.3.5/js/bootstrap.js?v=5a9f44d675"></script><script type="text/javascript" src="/gulpdemo/plugin/jquery-jbox/2.3/jquery.jBox-2.3.src.js?v=568416d5b1"></script><script type="text/javascript" src="/gulpdemo/js/main.js?v=6f399efa9e"></script><script type="text/javascript">var compareDate={compareWithNow:function(e){var t,a=this,r=e.split("|"),l=r[1].match(/\d{1,2}:\d{2} (AM|PM)/g);if(t=l?new Date(r[0]+a.clock12To24(l[0])):new Date(r[0]),"Invalid Date"==t)return null;var c=6,n=t.valueOf()+36e5*c,i=new Date,o=i.valueOf()+6e4*i.getTimezoneOffset();return o-n},clock12To24:function(e){var t="00:00";if(e.match(/^\d{1,2}:\d{2} (AM|PM)$/g)){var a=e.split(" ");if("AM"==a[1])t=a[0];else{var r=a[0].match(/^\d{1,2}/g);r&&(t=a[0].replace(/^\d{1,2}/,12+parseInt(r[0])))}}return t}};$("#compare").click(function(){$("#result").empty();var e=$("#input").val();if(""==e)alert("请输入CT时间");else if(e.match(/^[A-Z][a-z]+ \d{1,2}, \d+ \| \d{1,2}:\d{1,2} (AM|PM) CT$/g)){var t=compareDate.compareWithNow(e);t?$("#result").html("当前时间<strong> "+(t<0?"小于":t>0?"大于":"等于")+" </strong>"+e):alert("输入的时间有误！")}else alert("CT时间格式错误！")})</script><link rel="stylesheet" type="text/css" href="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shCoreDefault.css?v=b1f1863310"><script type="text/javascript" src="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shCore.js?v=990e7f9af1"></script><script type="text/javascript" src="/gulpdemo/plugin/syntaxhighlighter_3.0.83/shAutoloader.js?v=7b30a548e7"></script><script type="text/javascript">$(document).ready(function(){SyntaxHighlighter.autoloader(["js","jscript","javascript","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushJScript.js?v=614d07995f"],["css","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushCss.js?v=25fa849321"],["xml","html","/gulpdemo/plugin/syntaxhighlighter_3.0.83/shBrushXml.js?v=035d0131d7"]),SyntaxHighlighter.all()})</script></body></html>