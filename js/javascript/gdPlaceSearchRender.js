function getLngLat(){return $("#result").val()}"undefined"==typeof Lib&&(Lib={}),Lib.AMap=Lib.AMap||{},Lib.AMap.PlaceSearchRender=function(e){var a=this;a.ifShowCircle=!e,a.autoRender=function(e){a.clear(),e&&e.methodName&&e.methodArgumments&&(e.panel||e.map)&&(this.options=e,this.callback("complete",e.data))},a.callback=function(e,t){a.clear();var i=a.options;if(i.callback&&i.callback(e,t),"complete"==e){if(a.result=t,i.map){if(a._infoWindow=new AMap.InfoWindow({size:new AMap.Size(0,0),isCustom:!0,offset:new AMap.Pixel(0,(-30))}),a._overlays=[],a._highlightOverlay=null,(t.cityList||t.keywordList||t.poiList)&&a.drawOverlays(t),"searchNearBy"==i.methodName&&a.ifShowCircle){var n=a.options.methodArgumments;a.drawCircle(n[1],n[2])}if("searchInBounds"==i.methodName){var n=a.options.methodArgumments;a.drawBound(n[1])}}i.panel&&("[object String]"==Object.prototype.toString.call(i.panel)&&(i.panel=document.getElementById(i.panel)),i.panel.innerHTML=a.view.createPanel(t),a.enableListeners())}},a.clear=function(){this.clearPanel(),this.clearOverlays(),this.clearCircle(),this.clearBound()},a.drawOverlays=function(e){a.clearOverlays();var t=e.poiList.pois;a._overlays=this.addOverlays(t),a.options.map.setFitView(this._overlays,!0)},a.addOverlays=function(e){for(var t,i=this.options.map,n=[],o=0;o<e.length;o++)t=new AMap.Marker({map:i,offset:new AMap.Pixel((-9),(-31)),size:new AMap.Pixel(19,33),topWhenClick:!0,position:e[o].location,content:'<div class="amap_lib_placeSearch_poi">'+(o+1)+"</div>",draggable:!0}),e[o].index=o,t._data=e[o],AMap.event.addListener(t,"click",this.listener.markerClick),AMap.event.addListener(t,"dragging",a.listener.markerDragging),n.push(t);return n},a.clearPanel=function(){this.options&&this.options.panel&&(this.options.panel.innerHTML="")},a.clearOverlays=function(){if(this._overlays){for(var e,a=0;a<this._overlays.length;a++)e=this._overlays[a],e.setMap(null);this._overlays=[]}this._infoWindow&&this._infoWindow.close()},a.setCenter=function(e){var t=a._overlays[e];a.listener.markerClick.call(t),t.setTop(!0)},a.util={},a.util.getElementsByClassName=function(e,a,t){for(var i,n=new RegExp("(^|\\s)"+e+"(\\s|$)"),a=a||"*",t=t||document,o=t.getElementsByTagName(a),s=[],l=0;l<o.length;l++)i=o[l],n.test(i.className)&&s.push(i);return s},a.enableListeners=function(){for(var e,t=a.util.getElementsByClassName("poibox","*",a.options.panel),i=0;i<t.length;i++)e=t[i],AMap.event.addDomListener(e,"click",this.listener.unfocusTitleClick);for(var n,o=a.util.getElementsByClassName("pageLink","*",a.options.panel),i=0;i<o.length;i++)n=o[i],AMap.event.addDomListener(n,"click",a.listener.toPage)},a.listener={},a.listener.markerClick=function(){var e=this._data;a._infoWindow.setContent(a.view.createInfowindowContent(e)),a._infoWindow.open(a.options.map,this.getPosition()),a.options.map.setCenter(this.getPosition());for(var t=a._overlays,i=0,n=t.length;i<n;i++){var o=t[i].getContent();t[i].setContent(o.replace('"amap_lib_placeSearch_poi amap_lib_placeSearch_poi_active','"amap_lib_placeSearch_poi'))}var o=this.getContent();if(this.setContent(o.replace('"amap_lib_placeSearch_poi','"amap_lib_placeSearch_poi amap_lib_placeSearch_poi_active')),a.options.lngLat){var s=this.getPosition();document.getElementById(a.options.lngLat).value=s.lat+","+s.lng}var l=this._data.index;l!=a._currentIndex&&a.listener.unfocusTitleClick.call(a.util.getElementsByClassName("poibox","*",a.options.panel)[l],event,"click",l)},a.listener.markerDragging=function(e){if(a.options.lngLat){var t=e.target.getPosition();a._infoWindow.setPosition(t),document.getElementById(a.options.lngLat).value=t.lat+","+t.lng}},a.listener.unfocusTitleClick=function(e,t,i){a.last&&(a.last.className="poibox"),a._currentDiv=this;for(var n,o,s=this.parentNode.children,l=0;l<s.length;l++)if(o=s[l],o===this){n=l;break}a._currentIndex=n;var r=a._currentDiv;r.className="poibox active",a.last=r,void 0==i&&a.options.map&&a.setCenter(a._currentIndex)},a.listener.toPage=function(){var e=this.getAttribute("pageNo");a.toPage(e)},a.toPage=function(e){e.length&&(e=parseInt(e)),a.options.placeSearchInstance.setPageIndex(e),a.options.placeSearchInstance[a.options.methodName].apply(a.options.placeSearchInstance,a.options.methodArgumments)},a.view={},a.view.createInfowindowContent=function(e){var t=document.createElement("div"),i=document.createElement("div");i.className="amap-content-body";var n=[];n.push('<div class="amap-lib-infowindow">'),n.push('    <div class="amap-lib-infowindow-title">'+(e.index+1)+"."+e.name+'&nbsp;<a href="http://detail.amap.com/detail/'+e.id+"?spm=0.0.0.0.sWhSmy&citycode="+e.citycode+'" target="_blank">详情?</a></div>'),n.push('    <div class="amap-lib-infowindow-content">'),n.push('        <div class="amap-lib-infowindow-content-wrap">'),n.push("             <div>地址："+e.address+"</div>"),e.tel&&n.push("             <div>电话："+e.tel+"</div>"),n.push("        </div>"),n.push("    </div>"),n.push("</div>"),i.innerHTML=n.join("");var o=document.createElement("div");o.className="amap-combo-sharp",i.appendChild(o);var s=document.createElement("div");return s.className="amap-combo-close",i.appendChild(s),s.href="javascript: void(0)",AMap.event.addDomListener(s,"touchend",function(e){a._infoWindow.close()},this),AMap.event.addDomListener(s,"click",function(e){a._infoWindow.close()},this),t.appendChild(i),t.appendChild(s),t.appendChild(o),t},a.view.createPanel=function(e){if(!(e.poiList&&e.poiList.pois.length>0&&"NO_DATA"!=e.info))return"<div class='amap_lib_placeSearch'>抱歉，未搜索到有效的结果。</div>";var t=e.poiList.pois,i=[];i.push('<div class="amap_lib_placeSearch">'),i.push('    <div class="amap_lib_placeSearch_list">'),i.push("        <ul>");for(var n,o=0;o<t.length;o++)n=t[o],i.push('            <li class="poibox">'),i.push('                <div class="amap_lib_placeSearch_poi poibox-icon">'+(o+1)+"</div>"),i.push('                <h3 class="poi-title">'),i.push('                \t<span class="poi-name">'+n.name+"</span>"),i.push('                \t<a href="http://detail.amap.com/detail/'+n.id+"?spm=0.0.0.0.sWhSmy&citycode="+n.citycode+'" target="_blank" class="poi-more">详情&gt;</a>'),i.push("                </h3>"),i.push('                <div class="poi-info">'),i.push('                \t<p class="poi-addr">地址：'+n.address+"</p>"),n.tel&&i.push('                <p class="poi-tel">电话：'+n.tel+"</p>"),i.push("                </div>"),i.push("            </li>");i.push("        </ul>"),i.push("    </div>"),i.push('    <div class="amap_lib_placeSearch_page">'),i.push("        <div>"),i.push("            <p>");var s=e.poiList,l=s.count,r=s.pageIndex,c=s.pageSize,p=Math.ceil(l/c);return r>3&&i.push(a.view.createPageButton(1,"首页")),r>1&&i.push(a.view.createPageButton(r-1,"上一页")),r-2>=1&&i.push(a.view.createPageButton(r-2,r-2)),r-1>=1&&i.push(a.view.createPageButton(r-1,r-1)),i.push("                <span>"+r+"</span>"),r+1<=p&&i.push(a.view.createPageButton(r+1,r+1)),r+2<=p&&i.push(a.view.createPageButton(r+2,r+2)),r<p&&i.push(a.view.createPageButton(r+1,"下一页")),i.push("            </p>"),i.push("        </div>"),i.push("    </div>"),i.push("</div>"),i.join("")};var t={id:"place-search-circle",radius:3e3,strokeColor:"#72ccff",strokeOpacity:.8,strokeWeight:1,fillColor:"#d0e7f8",fillOpacity:.2,bubble:!0};a.drawCircle=function(e,i){a.clearCircle(),t.map=a.options.map,t.center=e,t.radius=i,a.searchCircle=new AMap.Circle(t)},a.clearCircle=function(){a.searchCircle&&(a.searchCircle.setMap(null),a.searchCircle=null)};var i={id:"place-search-bound",strokeColor:"#72ccff",strokeOpacity:.8,strokeWeight:1,fillColor:"#d0e7f8",fillOpacity:.2,bubble:!0};return a.drawBound=function(e){a.clearBound();var t=[];e.getNorthWest?t.push(e.getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()):t=e.getPath(),i.path=t,i.map=a.options.map;var n=new AMap.Polygon(i);a.searchBound=n},a.clearBound=function(){a.searchBound&&(a.searchBound.setMap(null),a.searchBound=null)},a.view.createPageButton=function(e,a){return"<span><a pageNo="+e+' class="pageLink" >'+a+"</a></span>"},a},$(function(){var e=new AMap.Map("container",{resizeEnable:!0,zoom:13});e.plugin(["AMap.Scale"],function(){var a=new AMap.Scale;e.addControl(a)});var a={name:utilities.getQueryString("name"),point:utilities.getQueryString("point"),city:utilities.getQueryString("city")||"010"},t=[116.397428,39.90923];if(a.point&&a.point.match(/^([1-9]|0\.)\d*(\.\d*)?,([1-9]|0\.)\d*(\.\d*)?$/)){var i=a.point.split(",");t=[Number($.trim(i[1])),Number($.trim(i[0]))];var n=$("#result");n.val(t[1]+","+t[0]),e.setCenter(t);var o=new AMap.Marker({map:e,position:t,draggable:!0,clickable:!1});a.name&&o.setLabel({offset:new AMap.Pixel(20,(-10)),content:a.name}),AMap.event.addListener(o,"dragging",function(e){var a=e.target.getPosition();n.val(a.lat+","+a.lng)})}else a.name&&AMap.service(["AMap.PlaceSearch"],function(){function t(o,s){if("complete"===o&&"OK"===s.info){var l=Lib.AMap.PlaceSearchRender();l.autoRender({placeSearchOptions:i,placeSearchInstance:n,methodName:"search",methodArgumments:[a.name,function(e,a){t(e,a)}],callback:function(){},lngLat:"result",map:e,panel:"panel",data:s}),setTimeout(function(){$(".amap_lib_placeSearch_list .poibox:first").trigger("click")},100)}}var i={pageSize:5,pageIndex:1,city:a.city},n=new AMap.PlaceSearch(i);n.search(a.name,function(e,a){t(e,a)})})});